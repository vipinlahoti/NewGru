<template name="story_item">
  <div class="{{storyClass}}" id="{{_id}}">
   <div class="story-body">
      <div class="media">

        {{#if isDeleted}}
          <div class="section-quarter story-deleted">This story has been deleted.</div>
        {{else}}
        
        <div class="pull-left">
          <!-- story user avatar -->
          {{> avatar userId=userId shape="circle"}}
        </div>

        <div class="media-body">
          <h5 class="media-heading">
            <!-- story author -->
            <a class="users-name" href="{{getProfileUrl userId}}">Dr. {{authorName}}</a>
            <!-- storyed time -->
            <small>&middot; {{timeAgo ago}}</small>
            {{#if isAdmin}}
              <small>&middot; {{full_date}}</small>
            {{/if}}
          </h5>
          
          <!-- Story content -->
          <p>{{{htmlBody}}}</p>

          <div class="media-footer">
            <!-- Reply button for logged in user -->
            {{#if isLoggedIn}}
              <a href="{{pathFor 'storyPage' _id=_id}}" class="btn btn-flat btn-sm upvote waves-effect waves-dark" rel="tooltip" title="" data-original-title="Reply to Story">{{{icon "reply"}}} Reply</a>
            {{/if}}
            
            <!-- Edit button -->
            {{#if canEdit this}}
              <a class="btn btn-flat btn-sm waves-effect waves-dark" href="{{pathFor 'storyEdit' _id=_id}}">{{{icon "edit"}}} Edit</a>
            {{/if}}
            
          </div>
        </div>
        {{/if}}
        <!-- Nested story -->
        {{#if showChildStories}}
          <div class="media-children {{storyListClass}}">
          {{#each childStories}}
            {{#with this}}
              {{> story_item}}
            {{/with}}
          {{/each}}
          </div>
        {{/if}}
      </div>
    </div>
  </div>
</template>
